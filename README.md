# Overview
SonarQube is a great free (Community Edition) tool to inspect code quality and identify any potential vulnerabilities. While the Community edition is great at identifying code-smells, the security related ruleset does not have good coverage. There are, however, a number of Open Source tools available out there that can perform SAST analysis. [Horusec](https://github.com/ZupIT/horusec) and [Checkov](https://github.com/ZupIT/horusec) are some examples. These tools can also output results in [SARIF](http://docs.oasis-open.org/sarif/sarif/v2.0/csprd01/sarif-v2.0-csprd01.html) format which defines a standard schema to exchange static analysis results. SonarQube does not support importing SARIF files, but it has its own JSON schema to import external issues. The challenge with importing these issues as generic third-party issues is that you can't see corresponding rules and documentation within SonarQube.  
This Plugin, solves that problem by creating rules (by scraping doco) within SonarQube and importing issues directly from the SARIF files.

# How to use the Plugin?
## Option #1: Build the plugin from Source
While you can use the plugin from the pre-built release package available in the repository, you can always regenerate the rules and rebuild the plugin from source if you need the latest rules from external tools to be available.  
1. Open the project in VSCode in the provided [Dev Container](https://code.visualstudio.com/docs/devcontainers/containers)  
2. Go to `/workspaces/sonar-external-analyzer/tools/rules-generator` directory and install all python dependencies by running `pip3 install -r requirements.txt`
3. Run `python3 main.py` to re-generate `src/resources/sonar-rules.xml`
4. Go back to the `/workspaces/sonar-external-analyzer` directory and run `mvn clean package` to generate a new JAR file.
5. Copy the `/workspaces/sonar-external-analyzer/target/sonar-external-analyzer-x.x.x.jar` file to SonarQube plugins directory and restart the server.
6. You should see new rules corresponding to supported external rules in SonarQube->Rules filter by Repository="External Analyzer Rules" 

## Option #2: Use pre-built plugin package
1. Download the  `sonar-external-analyzer-x.x.x.jar` file from the latest release and copy it to SonarQube plugins directory and restart the server.
2. You should see new rules corresponding to supported external rules in SonarQube->Rules filter by Repository="External Analyzer Rules"  

# How to run the analyzer?
Youc can point the Sonar Scanner at SARIF file(s) generated by the external scanners using the `sonar.sarif.path` property as shown in the below example.
```
dotnet sonarscanner begin /k:$SQ_PROJECT_KEY /d:sonar.login=$SQ_AUTH_TOKEN /d:sonar.host.url=http://localhost:9000 \
    /d:sonar.sarif.path=/workspace/checkov-results.sarif,/workspace/horusec-results.sarif

dotnet build

dotnet sonarscanner end /d:sonar.login=$SQ_AUTH_TOKEN
```
Login to SonarQube instance and see the issues created there per each result from the SARIF file.